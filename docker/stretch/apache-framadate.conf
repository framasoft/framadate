<VirtualHost *:80>
  DocumentRoot /var/www/framadate

  # URL rewrite
  <Directory "/">
    AllowOverride All

    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} -f [OR]
        RewriteCond %{REQUEST_FILENAME} -d
        RewriteRule . - [L]

        RewriteRule ^([a-zA-Z0-9-]+)$ studs.php?poll=$1 [L]
        RewriteRule ^([a-zA-Z0-9-]+)/action/([a-zA-Z_-]+)/(.+)$ studs.php?poll=$1&$2=$3
        RewriteRule ^([a-zA-Z0-9-]+)/vote/([a-zA-Z0-9]{16})$ studs.php?poll=$1&vote=$2
        RewriteRule ^([a-zA-Z0-9-]{24})/admin$ adminstuds.php?poll=$1
        RewriteRule ^([a-zA-Z0-9-]{24})/admin/vote/([a-zA-Z0-9]{16})$ adminstuds.php?poll=$1&vote=$2
        RewriteRule ^([a-zA-Z0-9-]{24})/admin/action/([a-zA-Z_-]+)(/(.+))?$ adminstuds.php?poll=$1&$2=$4
    </IfModule>

  </Directory>

  # Admin folder
  <Directory "/var/www/framadate/admin/">
    AuthType Basic
    AuthName "Administration"
    AuthUserFile "/var/www/framadate/admin/.htpasswd"
    Require valid-user
  </Directory>

  # Protection fichiers htpasswd et htaccess
  <FilesMatch "^\.ht.*">
    Deny from all
    Satisfy all
    ErrorDocument 403 "Accès refusé."
  </FilesMatch>

  # Logs
  ErrorLog /dev/stdout
  CustomLog /dev/stdout combined

</VirtualHost>
